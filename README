# Sistema AHP - AsignaciÃ³n de Docentes NEE

Sistema modular para asignar docentes a estudiantes con necesidades educativas especiales (NEE) usando AHP, **ahora con sistema de autenticaciÃ³n completo**.

# Sistema AHP - AsignaciÃ³n de Docentes NEE

Sistema modular para asignar docentes a estudiantes con necesidades educativas especiales (NEE) usando AHP, **con sistema de login simplificado**.

## ğŸ” Sistema de Login Simplificado

### CaracterÃ­sticas
- **Un solo usuario administrador**
- **AutenticaciÃ³n robusta** con tokens de sesiÃ³n
- **Sesiones seguras** con expiraciÃ³n automÃ¡tica (24 horas)
- **ContraseÃ±as hasheadas** con bcrypt
- **Limpieza automÃ¡tica** de sesiones expiradas

### Usuario del Sistema
```
ğŸ”‘ CREDENCIALES DE ACCESO:

ğŸ‘‘ Administrador Ãšnico:
   Usuario: admin
   ContraseÃ±a: admin123
```

### Crear Usuarios Adicionales (Solo por Base de Datos)
Si necesitas crear mÃ¡s usuarios, usa directamente la base de datos:

```sql
-- Ejemplo para crear un coordinador:
INSERT INTO usuarios (usuario, email, password, nombre_completo, rol, activo) 
VALUES ('coordinador', 'coord@universidad.edu.ec', 
        '$2y$10$TKh8H1.PfQx37YgCzwiKb.KjNyWgaHb9cbcoQgdIVFlYg7B77UdFm', 
        'Coordinador NEE', 'coordinador', 1);

-- Ejemplo para crear un docente:
INSERT INTO usuarios (usuario, email, password, nombre_completo, rol, activo) 
VALUES ('docente1', 'docente1@universidad.edu.ec', 
        '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 
        'Nombre del Docente', 'docente', 1);

-- Nota: La contraseÃ±a del ejemplo es 'admin123'
-- Para generar nueva contraseÃ±a: password_hash('tucontraseÃ±a', PASSWORD_DEFAULT)
```

## ğŸ“ Archivos del Sistema de Login

### Archivos Principales
- `login.php` - PÃ¡gina principal de login
- `includes/auth.php` - Middleware de autenticaciÃ³n simplificado
- `procesar/procesar_login.php` - Procesador de autenticaciÃ³n
- `procesar/procesar_logout.php` - Procesador de cierre de sesiÃ³n

### Archivos Actualizados
- `index.php` - RedirecciÃ³n inteligente segÃºn estado de login
- `includes/header.php` - Barra de usuario y verificaciÃ³n de autenticaciÃ³n
- `includes/nav.php` - NavegaciÃ³n simplificada (sin roles complejos)

### âŒ Archivos NO Necesarios
- ~~`pages/admin_usuarios.php`~~ - **NO CREAR** (sin gestiÃ³n de usuarios por interfaz)
- ~~`procesar/procesar_usuario.php`~~ - **NO CREAR** (sin CRUD de usuarios)

## ğŸ› ï¸ InstalaciÃ³n Simplificada

### 1. Ejecutar Script SQL
```sql
-- Ejecutar en phpMyAdmin o MySQL Workbench
SOURCE basededatos.sql;

-- Luego ejecutar SOLO la parte de login simplificada
-- Esto crearÃ¡: usuarios, sesiones_usuario
-- E insertarÃ¡ ÃšNICAMENTE el usuario admin
```

### 2. Estructura de Archivos Final
```
proyecto/
â”œâ”€â”€ login.php                    # ğŸ†• PÃ¡gina de login
â”œâ”€â”€ index.php                   # âœ… Actualizado - RedirecciÃ³n inteligente
â”œâ”€â”€ css/styles.css              # Sin cambios
â”œâ”€â”€ js/scripts.js              # Sin cambios
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ auth.php               # ğŸ†• Middleware simplificado
â”‚   â”œâ”€â”€ header.php             # âœ… Actualizado - Con barra de usuario
â”‚   â”œâ”€â”€ nav.php                # âœ… Actualizado - NavegaciÃ³n simplificada
â”‚   â”œâ”€â”€ footer.php             # Sin cambios
â”‚   â”œâ”€â”€ conexion.php           # Sin cambios
â”‚   â””â”€â”€ config.php             # Sin cambios
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ dashboard.php          # âœ… Protegido con autenticaciÃ³n
â”‚   â”œâ”€â”€ docentes.php           # âœ… Protegido
â”‚   â”œâ”€â”€ estudiantes.php        # âœ… Protegido
â”‚   â”œâ”€â”€ asignacion.php         # âœ… Protegido
â”‚   â””â”€â”€ reportes.php           # âœ… Protegido
â”œâ”€â”€ procesar/
â”‚   â”œâ”€â”€ procesar_login.php     # ğŸ†• Manejo de autenticaciÃ³n
â”‚   â”œâ”€â”€ procesar_logout.php    # ğŸ†• Cierre de sesiÃ³n
â”‚   â””â”€â”€ [otros archivos existentes sin cambios...]
â””â”€â”€ classes/
    â””â”€â”€ [archivos existentes sin cambios...]
```

## ğŸš€ Flujo de Uso Simplificado

### 1. Acceso
1. **Navegar a** `http://localhost/[tu-proyecto]/`
2. **Redirige automÃ¡ticamente** a `login.php`
3. **Usar credenciales**: admin / admin123
4. **Acceder al sistema** completo

### 2. Funcionalidades Disponibles
- âœ… Dashboard con estadÃ­sticas completas
- âœ… GestiÃ³n de docentes y estudiantes  
- âœ… Asignaciones AHP automÃ¡ticas
- âœ… Reportes y generaciÃ³n de PDFs
- âœ… Todas las funcionalidades AHP existentes

### 3. GestiÃ³n de Usuarios
- âœ… **Usuario principal**: admin (creado automÃ¡ticamente)
- âœ… **Usuarios adicionales**: Solo por INSERT en base de datos
- âŒ **NO hay interfaz** de gestiÃ³n de usuarios
- âŒ **NO hay formularios** de creaciÃ³n

## ğŸ”§ ImplementaciÃ³n TÃ©cnica

### Base de Datos MÃ­nima
```sql
-- Solo estas tablas para autenticaciÃ³n:
usuarios (id_usuario, usuario, password, nombre_completo, rol, activo...)
sesiones_usuario (id_sesion, id_usuario, token_sesion, ip_address...)

-- Procedimientos simplificados:
validar_login(), crear_sesion(), validar_sesion(), cerrar_sesion()
```

### Middleware Simplificado
```php
// Uso en todas las pÃ¡ginas protegidas:
require_once '../includes/auth.php';
requireAuth(); // Solo verifica que estÃ© logueado
```

## ğŸ¯ CaracterÃ­sticas AHP (Sin Cambios)

Todas las funcionalidades del sistema AHP se mantienen exactamente igual:

- âœ… **Dashboard**: EstadÃ­sticas en tiempo real con grÃ¡ficos
- âœ… **GestiÃ³n Docentes**: CRUD con triggers automÃ¡ticos  
- âœ… **GestiÃ³n Estudiantes**: Registro por tipo de discapacidad
- âœ… **AsignaciÃ³n AHP**: Algoritmo automÃ¡tico con vista previa
- âœ… **Reportes PDF**: GeneraciÃ³n de informes personalizados
- âœ… **Algoritmo optimizado**: Balanceado de carga y pesos especÃ­ficos

## ğŸ›¡ï¸ Seguridad Implementada

- âœ… ContraseÃ±as hasheadas con bcrypt
- âœ… Tokens de sesiÃ³n criptogrÃ¡ficos  
- âœ… ValidaciÃ³n de entrada en formularios
- âœ… ProtecciÃ³n contra SQL injection
- âœ… Sesiones con expiraciÃ³n automÃ¡tica
- âœ… Limpieza automÃ¡tica de sesiones

## ğŸ“ Notas Importantes

### âœ… Implementar:
- `login.php`
- `includes/auth.php` (versiÃ³n simplificada)
- `procesar/procesar_login.php`
- `procesar/procesar_logout.php`
- Actualizar `index.php`, `header.php`, `nav.php`

### âŒ NO Implementar:
- ~~Panel de administraciÃ³n de usuarios~~
- ~~Formularios de creaciÃ³n de usuarios~~
- ~~Sistema de roles complejos~~
- ~~GestiÃ³n de permisos granulares~~

### ğŸ”„ Para Crear Usuarios Adicionales:
1. **Usar phpMyAdmin** o cualquier cliente MySQL
2. **Ejecutar INSERT** con contraseÃ±a hasheada
3. **Usar password_hash()** en PHP si necesitas generar hash

---

**ğŸ“ Universidad Estatal de Guayaquil**  
**ğŸ“ Facultad de Ciencias MatemÃ¡ticas y FÃ­sicas**  
**ğŸ¤– Sistema AHP con Login Simplificado**

## ğŸ“ Nuevos Archivos del Sistema de Login

### Archivos Principales
- `login.php` - PÃ¡gina principal de login
- `includes/auth.php` - Middleware de autenticaciÃ³n
- `procesar/procesar_login.php` - Procesador de autenticaciÃ³n
- `procesar/procesar_logout.php` - Procesador de cierre de sesiÃ³n
- `procesar/procesar_usuario.php` - GestiÃ³n de usuarios (admin)
- `pages/admin_usuarios.php` - Panel de administraciÃ³n de usuarios

### Archivos Actualizados
- `index.php` - RedirecciÃ³n inteligente segÃºn estado de login
- `includes/header.php` - Barra de usuario y verificaciÃ³n de autenticaciÃ³n
- `includes/nav.php` - NavegaciÃ³n con permisos por rol

## ğŸ› ï¸ InstalaciÃ³n del Sistema de Login

### 1. Ejecutar Script SQL
```sql
-- Ejecutar en phpMyAdmin o MySQL Workbench
SOURCE basededatos.sql;

-- Luego ejecutar el script de login (incluido en el repositorio)
-- Esto crearÃ¡ las tablas: usuarios, sesiones_usuario
-- E insertarÃ¡ los usuarios predeterminados
```

### 2. ConfiguraciÃ³n de la Base de Datos
El sistema ya estÃ¡ configurado para trabajar con:
- **Host**: localhost
- **Base de datos**: asignacion_docente  
- **Usuario**: moises
- **ContraseÃ±a**: moises

### 3. Estructura de Archivos Completa
```
proyecto/
â”œâ”€â”€ login.php                    # ğŸ†• PÃ¡gina de login
â”œâ”€â”€ index.php                   # âœ… Actualizado - RedirecciÃ³n inteligente
â”œâ”€â”€ css/styles.css              # Estilos existentes
â”œâ”€â”€ js/scripts.js              # Scripts existentes
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ auth.php               # ğŸ†• Middleware de autenticaciÃ³n
â”‚   â”œâ”€â”€ header.php             # âœ… Actualizado - Con barra de usuario
â”‚   â”œâ”€â”€ nav.php                # âœ… Actualizado - NavegaciÃ³n por roles
â”‚   â”œâ”€â”€ footer.php             # Sin cambios
â”‚   â”œâ”€â”€ conexion.php           # Sin cambios
â”‚   â””â”€â”€ config.php             # Sin cambios
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ dashboard.php          # âœ… Protegido con autenticaciÃ³n
â”‚   â”œâ”€â”€ docentes.php           # âœ… Protegido (coordinador+)
â”‚   â”œâ”€â”€ estudiantes.php        # âœ… Protegido (coordinador+)
â”‚   â”œâ”€â”€ asignacion.php         # âœ… Protegido (coordinador+)
â”‚   â”œâ”€â”€ reportes.php           # âœ… Protegido (coordinador+)
â”‚   â””â”€â”€ admin_usuarios.php     # ğŸ†• Solo administradores
â”œâ”€â”€ procesar/
â”‚   â”œâ”€â”€ procesar_login.php     # ğŸ†• Manejo de autenticaciÃ³n
â”‚   â”œâ”€â”€ procesar_logout.php    # ğŸ†• Cierre de sesiÃ³n
â”‚   â”œâ”€â”€ procesar_usuario.php   # ğŸ†• CRUD de usuarios (admin)
â”‚   â””â”€â”€ [otros archivos existentes...]
â””â”€â”€ classes/
    â””â”€â”€ [archivos existentes sin cambios...]
```

## ğŸš€ Flujo de Uso del Sistema

### 1. Acceso Inicial
1. **Navegar a** `http://localhost/[tu-proyecto]/`
2. **Redirige automÃ¡ticamente** a `login.php`
3. **Usar credenciales** predeterminadas
4. **Acceder al dashboard** segÃºn rol

### 2. NavegaciÃ³n por Roles

#### ğŸ‘‘ Administrador (admin/admin123)
- âœ… Dashboard con estadÃ­sticas completas
- âœ… GestiÃ³n de docentes y estudiantes  
- âœ… Asignaciones AHP
- âœ… Reportes y estadÃ­sticas
- âœ… **AdministraciÃ³n de usuarios** (crear, editar, desactivar)
- âœ… Control de sesiones activas

#### ğŸ“‹ Coordinador (coordinador/coord123)  
- âœ… Dashboard con estadÃ­sticas
- âœ… GestiÃ³n de docentes y estudiantes
- âœ… Asignaciones AHP automÃ¡ticas
- âœ… GeneraciÃ³n de reportes PDF
- âŒ No acceso a administraciÃ³n de usuarios

#### ğŸ‘¨â€ğŸ« Docente (prÃ³ximamente)
- âœ… Dashboard bÃ¡sico
- âœ… Vista de sus asignaciones
- âŒ No acceso a gestiÃ³n ni administraciÃ³n

### 3. Funcionalidades de Seguridad

#### GestiÃ³n de Sesiones
- **ExpiraciÃ³n automÃ¡tica**: 24 horas de inactividad
- **Tokens Ãºnicos**: Cada sesiÃ³n tiene un token criptogrÃ¡fico
- **Limpieza automÃ¡tica**: Sesiones expiradas se eliminan automÃ¡ticamente
- **Control multi-dispositivo**: Un usuario puede tener mÃºltiples sesiones

#### Panel de AdministraciÃ³n (Solo Admin)
- **Crear usuarios** con roles especÃ­ficos
- **Activar/Desactivar** cuentas de usuario
- **Cerrar sesiones remotas** de otros usuarios
- **Eliminar usuarios** (con confirmaciÃ³n de seguridad)
- **Monitoreo en tiempo real** de sesiones activas

## ğŸ”§ Funcionalidades TÃ©cnicas

### Middleware de AutenticaciÃ³n
```php
// Uso en pÃ¡ginas protegidas
require_once '../includes/auth.php';
requireAuth('coordinador'); // Requiere rol coordinador o superior
```

### VerificaciÃ³n de Roles
- **Sistema jerÃ¡rquico**: admin > coordinador > docente
- **Control granular**: Cada pÃ¡gina puede requerir un rol especÃ­fico
- **RedirecciÃ³n automÃ¡tica**: Error 403 si no tiene permisos

### Base de Datos de Seguridad
```sql
-- Nuevas tablas para autenticaciÃ³n
usuarios (id_usuario, usuario, password, nombre_completo, rol, activo...)
sesiones_usuario (id_sesion, id_usuario, token_sesion, ip_address...)

-- Procedimientos almacenados
validar_login(), crear_sesion(), validar_sesion(), cerrar_sesion()
```

## ğŸ¯ CaracterÃ­sticas del Sistema AHP (Sin Cambios)

### Algoritmo AHP Optimizado
- **Criterios Principales**: Tipos de discapacidad con pesos especÃ­ficos
- **Subcriterios**: FSI (28%), EPR (32%), AMI (16%), AED (13%), NFA (11%)
- **Balanceado de carga**: Evita sobrecargar docentes
- **Triggers automÃ¡ticos**: InserciÃ³n inteligente de datos

### Funcionalidades Principales
- âœ… **Dashboard**: EstadÃ­sticas en tiempo real con grÃ¡ficos
- âœ… **GestiÃ³n Docentes**: CRUD con triggers automÃ¡ticos  
- âœ… **GestiÃ³n Estudiantes**: Registro por tipo de discapacidad
- âœ… **AsignaciÃ³n AHP**: Algoritmo automÃ¡tico con vista previa
- âœ… **Reportes PDF**: GeneraciÃ³n de informes personalizados

## ğŸ“Š PrÃ³ximas Mejoras

### Corto Plazo
- [ ] **Vista de docente** completa (mis asignaciones, horarios)
- [ ] **EdiciÃ³n de usuarios** en el panel de admin
- [ ] **RecuperaciÃ³n de contraseÃ±a** por email
- [ ] **Logs de auditorÃ­a** detallados

### Mediano Plazo  
- [ ] **API REST** para integraciÃ³n externa
- [ ] **Dashboard mÃ³vil** responsivo mejorado
- [ ] **Notificaciones** en tiempo real
- [ ] **ExportaciÃ³n** de datos en mÃºltiples formatos

## ğŸ›¡ï¸ Consideraciones de Seguridad

### Implementadas
- âœ… ContraseÃ±as hasheadas con bcrypt
- âœ… Tokens de sesiÃ³n criptogrÃ¡ficos  
- âœ… ValidaciÃ³n de entrada en todos los formularios
- âœ… ProtecciÃ³n contra SQL injection
- âœ… Control de acceso basado en roles
- âœ… Limpieza automÃ¡tica de sesiones

### Recomendaciones Adicionales
- ğŸ”„ Cambiar contraseÃ±as predeterminadas en producciÃ³n
- ğŸ”„ Configurar HTTPS en servidor de producciÃ³n  
- ğŸ”„ Implementar rate limiting para intentos de login
- ğŸ”„ Configurar backup automÃ¡tico de base de datos

## ğŸ“ Soporte

Para cualquier problema con el sistema de login o autenticaciÃ³n:

1. **Verificar credenciales** predeterminadas
2. **Comprobar conexiÃ³n** a base de datos  
3. **Revisar logs** en `logs/` (si estÃ¡n habilitados)
4. **Limpiar sesiones** con `SELECT limpiar_sesiones_expiradas();`

---

**ğŸ“ Universidad Estatal de Guayaquil**  
**ğŸ“ Facultad de Ciencias MatemÃ¡ticas y FÃ­sicas**  
**ğŸ¤– Sistema AHP con AutenticaciÃ³n Completa v2.0**